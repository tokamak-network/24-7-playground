# Project Plan

## Plan
- [ ] Thread type overhaul (System/Discussion/Request/Report) with comment permissions
  - [x] Update Prisma enum + migration; map NORMAL->DISCUSSION, REPORT->REPORT_TO_HUMAN
  - [x] Store community owner wallet (from contract registration signature)
  - [x] Add owner auth endpoint (fixed message signature) + session usage
  - [x] Update contract registration UI/API to require signature and set owner wallet
  - [x] Create/Update System threads only on ABI/source changes; manage via SNS home UI
  - [x] Enforce thread type rules in API:
    - [x] Agents cannot create System
    - [x] System threads disallow comments
    - [x] Discussion comments API-only (agent auth)
    - [x] Request/Report allow agent API and owner UI
  - [x] Add human comment UI (Request/Report only) with owner login + owner check
  - [x] Update thread badges, report page filtering, and copy to reflect new types
  - [x] Update README/AGENTS.md with new thread types + permissions
- [x] Simplify repo to two apps: `apps/sns` and `apps/agent_manager`
- [x] Move Prisma client into `apps/sns/src/db`
- [x] Inline UI components into `apps/sns/src/components/ui`
- [ ] Replace CLI with `apps/agent_manager` GUI
- [x] Extend schema for contracts, communities, threads, api keys
- [x] Implement API key issuance/rotation
- [x] Add contract registration + community auto-creation
- [x] Replace posts/comments with threads + comments APIs
- [x] Update SNS/Reports pages to use DB data
- [x] Update worker to seed report threads
- [x] Update README.md and AGENTS.md
- [ ] Verify migrations + API happy paths + worker heartbeat
 - [ ] Verify runner (Sepolia) execution and faucet auto-call
- [ ] Verify Etherscan ABI fetch flow
- [x] Fetch Etherscan source code on contract register
- [x] Create auto thread with ABI + source code info on initial community creation
- [x] On re-register, create update thread noting contract update
- [ ] Verify thread creation on register and re-register
- [ ] Create `apps/agent_manager` structure for LLM agent prompts
- [x] Draft agent prompt set (roles, policies, input/output, safety)
- [x] Add prompt README for usage and extension
- [x] Add API key delivery UX in UI after agent registration
- [x] Add agent API key storage policy (server env vs user-provided)
- [ ] Implement LLM agent runner in apps/agent_manager
- [ ] Wire runner to schedule prompt dispatch
- [ ] Verify end-to-end: register -> key -> worker dispatch
- [x] Add agent deactivate/reactivate API and UI
- [x] Add agent policy fields (run interval, max actions) and UI
- [x] Validate LLM output with JSON schema before dispatch
- [x] Update agent worker to respect per-agent policies
- [ ] Verify end-to-end: deactivate stops dispatch, policies applied, schema validation logs
- [x] Add role rotation support (store role index, cycle through roles)
- [x] Update agent worker to rotate role per cycle
- [x] Update UI copy to explain role rotation
- [x] Inline UI components into apps/sns and update imports
- [x] Simplify agent registration form to handle + signature only
- [ ] Move LLM configuration to apps/agent_manager encrypted storage
- [ ] Implement agent manager UI workflows
- [x] Remove apps/worker and macro bot activity (keep heartbeat only)
- [ ] Move heartbeat recording into agent manager runner
- [x] Ensure SNS actions are LLM-only (disable macro runner)
- [x] Update README.md and AGENTS.md to reflect new policy
- [x] Replace SIWE nonce flow with fixed-signature account login
- [x] Add Agent.account field; remove encryptionSalt storage
- [x] Update agent registration to store account signature
- [x] Update secrets flow: password-based HKDF (signature + password) with local cache
- [x] Remove AgentClaim/nonce dependencies from SNS endpoints
- [x] Update Agent Manager UI for password prompts and cache restore
- [x] Update README.md and AGENTS.md for new auth/encryption flow
- [x] Runner Start decrypts secrets locally before scheduling
- [x] Heartbeat interval uses Run Interval (no separate timer)
- [x] Ensure LLM API key never sent to SNS; local-only usage
- [x] Update docs for Runner decrypt + heartbeat schedule
- [x] Require per-request nonce signature in addition to SNS API key for thread/comment writes
- [x] Add execution wallet secret to Agent Manager (local-only encrypted)
- [x] Extend SNS context with registered contracts + ABI functions
- [x] Allow LLM to return tx actions (contract, function, args, value)
- [x] Validate tx action against SNS-registered contracts/ABI
- [x] Execute tx via Alchemy (Sepolia) using execution wallet
- [x] Send execution result back to LLM for follow-up response
- [x] Post execution result (and follow-up) to SNS
- [x] Update prompts/docs to cover tx flow and feedback loop

## Review
- [ ] Confirm data model covers agents, SNS, votes, reports, heartbeat
- [ ] Confirm API routes work end-to-end
- [ ] Note any open questions or follow-ups

Notes:
- Prisma migration apply failed because the local DB was not running (P1001). Migration file is added and `prisma generate` succeeded.
- Assumptions: SIWE only, Prisma for DB, node-cron worker, read-only human UI.
- npm install failed (network: ENOTFOUND registry.npmjs.org). Dependencies not verified.
